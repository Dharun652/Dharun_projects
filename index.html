  <!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aquatic Ecosystem Explorer ‚Äî Fixed Game</title>
<style>
  :root{
    --bg:#071520; --card:#0f2430; --accent:#00c0ff; --muted:#9fd8ea; --radius:12px;
  }
  html,body{height:100%; margin:0; font-family:Inter,Roboto,Arial; background:var(--bg); color:#eaf8ff;}
  .hero{min-height:60vh; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px; text-align:center; padding:28px;}
  h1{font-size:34px; margin:0; text-shadow:0 6px 20px rgba(0,200,255,0.06);}
  .menu{display:flex; gap:12px; flex-wrap:wrap;}
  .menu button{background:linear-gradient(180deg,var(--accent),#0066ff); color:#001; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;}
  main{padding:20px 16px 60px;}
  .page{display:none; animation:fade .28s ease;}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
  .card{max-width:980px; margin:18px auto; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; box-shadow:0 8px 30px rgba(0,0,0,0.35);}
  .backBtn, .btn { background:#083447; color:#eaf8ff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700; }
  #gameBox{height:320px; border-radius:10px; background:linear-gradient(180deg, rgba(0,60,90,0.08), rgba(0,40,60,0.06)); position:relative; overflow:hidden; border:1px solid rgba(0,200,255,0.06); margin-top:12px;}
  .gameObject{position:absolute; font-size:36px; cursor:pointer; user-select:none; transform-origin:center; transition:transform .12s;}
  .gameObject:hover{transform:scale(1.08) rotate(-6deg);}
  .hud{display:flex; gap:12px; align-items:center; margin-top:8px; color:var(--muted);}
  .small{font-size:14px; color:var(--muted);}
  .confetti{position:absolute; width:10px; height:14px; border-radius:2px; pointer-events:none; opacity:0.95;}
  @media (max-width:640px){ h1{font-size:24px} }
</style>
</head>
<body>

<section class="hero" id="home">
  <h1>üåä Aquatic Ecosystem Explorer</h1>
  <div class="menu" role="navigation">
    <button class="menuBtn" data-target="lifestyle">üê† Lifestyle</button>
    <button class="menuBtn" data-target="importance">üåé Importance</button>
    <button class="menuBtn" data-target="destruction">‚ö†Ô∏è Destruction</button>
    <button class="menuBtn" data-target="game">üéÆ Game</button>
  </div>
  <div class="small">Tip: press "g" to open the game, "Esc" to go home</div>
</section>

<main>
  <section id="lifestyle" class="page">
    <div class="card">
      <h2>üêü Aquatic Lifestyle</h2>
      <p>Fish use gills, dolphins are mammals, streamlined shapes help movement.</p>
      <button class="backBtn" data-action="home">‚¨Ö Back</button>
    </div>
  </section>

  <section id="importance" class="page">
    <div class="card">
      <h2>üåä Importance</h2>
      <p>Oceans regulate climate and provide food, jobs and medicine.</p>
      <button class="backBtn" data-action="home">‚¨Ö Back</button>
    </div>
  </section>

  <section id="destruction" class="page">
    <div class="card">
      <h2>‚ö†Ô∏è Destruction</h2>
      <p>Plastic, oil spills and warming waters harm species and reefs.</p>
      <button class="backBtn" data-action="home">‚¨Ö Back</button>
    </div>
  </section>

  <section id="game" class="page" aria-hidden="true">
    <div class="card">
      <h2>üéÆ Save The Ocean</h2>
      <p class="small">Click trash üóëÔ∏è to collect points. Avoid clicking fish üêü. Game lasts 45 seconds.</p>

      <div class="hud">
        <div id="score" class="small">Score: 0</div>
        <div id="level" class="small">Level: 1</div>
        <div id="timer" class="small">Time: 45s</div>
      </div>

      <div id="gameBox" aria-live="polite" aria-label="Game area"></div>

      <div style="margin-top:12px;">
        <button id="startBtn" class="btn">‚ñ∂ Start</button>
        <button class="backBtn" data-action="home">‚¨Ö Back</button>
      </div>
    </div>
  </section>
</main>

<script>
document.addEventListener('DOMContentLoaded', ()=>{

  /* ---------- PAGES ---------- */
  const pages = ['lifestyle','importance','destruction','game'];
  const menuBtns = document.querySelectorAll('.menuBtn');
  const homeEl = document.getElementById('home');

  function showPage(id){
    homeEl.style.display = 'none';
    pages.forEach(p => {
      const el = document.getElementById(p);
      if(el) el.style.display = (p===id) ? 'block' : 'none';
    });
    // when entering non-game page, clear game
    if(id !== 'game') clearGame();
  }

  function goHome(){
    pages.forEach(p => { const el = document.getElementById(p); if(el) el.style.display = 'none'; });
    homeEl.style.display = 'block';
    clearGame();
  }

  menuBtns.forEach(b => b.addEventListener('click', ()=> {
    const t = b.dataset.target;
    if(t) showPage(t);
  }));

  document.querySelectorAll('[data-action="home"]').forEach(bt => bt.addEventListener('click', goHome));

  document.addEventListener('keydown', (e)=> {
    if(e.key === 'g') showPage('game');
    if(e.key === 'Escape') goHome();
  });

  /* ---------- SIMPLE THEME SWITCH (kept minimal) ---------- */
  // Not required for game fix ‚Äî omitted for clarity.

  /* ---------- GAME LOGIC (reliable) ---------- */
  const gameBox = document.getElementById('gameBox');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const timerEl = document.getElementById('timer');
  const startBtn = document.getElementById('startBtn');

  let score = 0;
  let level = 1;
  let timeLeft = 45;
  let active = false;
  let spawnTimer = null;
  let countdownTimer = null;
  let spawnInterval = 1000;

  // helper random
  const r = (min,max) => Math.floor(Math.random()*(max-min+1)) + min;

  function updateHUD(){
    scoreEl.innerText = 'Score: ' + score;
    levelEl.innerText = 'Level: ' + level;
    timerEl.innerText = 'Time: ' + timeLeft + 's';
  }

  function clearGame(){
    active = false;
    clearInterval(spawnTimer);
    clearInterval(countdownTimer);
    spawnTimer = null;
    countdownTimer = null;
    // remove all game objects
    if(gameBox) gameBox.innerHTML = '';
    score = 0; level = 1; timeLeft = 45;
    updateHUD();
    startBtn.innerText = '‚ñ∂ Start';
  }

  function endGame(){
    active = false;
    clearInterval(spawnTimer);
    clearInterval(countdownTimer);
    spawnTimer = null;
    countdownTimer = null;
    startBtn.innerText = '‚ñ∂ Start';
    // show result overlay briefly
    const res = document.createElement('div');
    res.style.position='absolute';
    res.style.left='50%'; res.style.top='50%';
    res.style.transform='translate(-50%,-50%)';
    res.style.padding='14px 18px';
    res.style.borderRadius='10px';
    res.style.background='rgba(0,0,0,0.7)';
    res.style.color='#fff';
    res.style.zIndex=9999;
    res.innerHTML = `<strong>Time's up!</strong><div style="margin-top:6px">Final score: <strong>${score}</strong></div>`;
    document.body.appendChild(res);
    setTimeout(()=> res.remove(), 2000);
  }

  function spawnObject(){
    if(!active) return;
    // create element
    const el = document.createElement('div');
    el.className = 'gameObject';
    // decide type
    const chanceTrash = Math.min(0.72, 0.5 + level*0.03); // more trash at higher levels but bounded
    const isTrash = Math.random() < chanceTrash;
    el.textContent = isTrash ? 'üóëÔ∏è' : 'üêü';
    el.dataset.type = isTrash ? 'trash' : 'fish';

    // random size
    const size = r(30,48);
    el.style.fontSize = size + 'px';

    // initial position inside gameBox bounds
    const boxRect = gameBox.getBoundingClientRect();
    const maxLeft = Math.max(8, boxRect.width - 60);
    const maxTop = Math.max(8, boxRect.height - 60);
    const left = r(8, maxLeft);
    const top = r(8, maxTop);
    el.style.left = left + 'px';
    el.style.top = top + 'px';

    // gentle drifting using CSS transform + short interval nudges
    const dur = 3000 + r(0,1800);
    el.style.transition = 'transform 700ms linear, left 260ms linear, top 260ms linear';
    // small random motion vector
    let dx = (Math.random()-0.5) * (0.8 + (level*0.06));
    let dy = (Math.random()-0.5) * 0.6;

    // attach click
    el.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      if(!active) return;
      if(el.dataset.type === 'trash'){
        score += 1;
      } else {
        score = Math.max(0, score - 1);
      }
      updateHUD();
      // remove element and spawn replacement quickly
      el.remove();
      // immediate replacement so area stays filled
      setTimeout(spawnObject, r(200,600));
      // increase difficulty when hitting thresholds
      if(score > 0 && score % 6 === 0){
        level = 1 + Math.floor(score / 6);
        spawnInterval = Math.max(420, 1000 - (level-1)*90);
        if(spawnTimer){ clearInterval(spawnTimer); spawnTimer = setInterval(spawnObject, spawnInterval); }
      }
    });

    gameBox.appendChild(el);

    // nudge interval (keeps movement)
    let life = 0;
    const nudge = setInterval(()=>{
      if(!el.parentElement){ clearInterval(nudge); return; }
      life++;
      const curLeft = parseFloat(el.style.left);
      const curTop = parseFloat(el.style.top);
      let nx = curLeft + dx * 8; // scale nudges for visible motion
      let ny = curTop + dy * 6;
      // bounce edges
      if(nx < 4){ nx = 4; dx *= -1; }
      if(nx > maxLeft){ nx = maxLeft; dx *= -1; }
      if(ny < 4){ ny = 4; dy *= -1; }
      if(ny > maxTop){ ny = maxTop; dy *= -1; }
      el.style.left = nx + 'px';
      el.style.top = ny + 'px';
      if(life > r(12, 20)){ el.remove(); clearInterval(nudge); }
    }, 320);

    // safety remove after long time
    setTimeout(()=> { if(el.parentElement) el.remove(); }, 12000);
  }

  function tick(){
    if(!active) return;
    timeLeft--;
    updateHUD();
    if(timeLeft <= 0){
      endGame();
    }
  }

  // start / pause toggle
  startBtn.addEventListener('click', ()=>{
    if(!active){
      // start
      active = true;
      score = 0; level = 1; timeLeft = 45;
      updateHUD();
      gameBox.innerHTML = '';
      spawnInterval = 1000;
      // spawn a few initial objects
      for(let i=0;i<6;i++) setTimeout(spawnObject, i*220);
      // spawn periodically
      if(spawnTimer) clearInterval(spawnTimer);
      spawnTimer = setInterval(spawnObject, spawnInterval);
      if(countdownTimer) clearInterval(countdownTimer);
      countdownTimer = setInterval(tick, 1000);
      startBtn.innerText = '‚è∏ Pause';
    } else {
      // pause
      active = false;
      startBtn.innerText = '‚ñ∂ Resume';
      clearInterval(spawnTimer);
      clearInterval(countdownTimer);
      spawnTimer = null;
      countdownTimer = null;
    }
  });

  // ensure game cleared when leaving page
  document.querySelectorAll('.menuBtn, [data-action="home"]').forEach(el=>{
    el.addEventListener('click', ()=> {
      clearGame();
    });
  });

  // helper to clear gracefully
  function clearGame(){
    active = false;
    clearInterval(spawnTimer);
    clearInterval(countdownTimer);
    spawnTimer = null;
    countdownTimer = null;
    if(gameBox) gameBox.innerHTML = '';
    score = 0; level = 1; timeLeft = 45;
    updateHUD();
    startBtn.innerText = '‚ñ∂ Start';
  }

  // initialize HUD and show home
  updateHUD();
  goHome = ()=> { // expose goHome for page controls
    document.getElementById('home').style.display = 'block';
    pages.forEach(p => { const el = document.getElementById(p); if(el) el.style.display = 'none'; });
    clearGame();
  };
  // attach showPage to menu buttons already done above (they call showPage)
  // ensure home visible on load
  document.getElementById('home').style.display = 'block';

}); // DOMContentLoaded
</script>
</body>
</html>
